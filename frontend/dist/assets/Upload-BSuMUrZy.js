import{u as b}from"./api-B5B5DeYR.js";import{_ as w,c as T,a as o,w as l,b as a,d,e as m,t as h,f as _,r as s,o as p}from"./index-ahAVBiDV.js";const v={name:"Upload",data(){return{file:null,fileType:"需求规格说明",loading:!1,uploadSuccess:!1,uploadError:"",docId:"",fileName:""}},methods:{handleFileChange(i){this.file=i.raw},handleExceed(){this.$message.warning("只能上传一个文件")},async handleUpload(){if(!this.file){this.$message.error("请选择文件");return}if(!this.fileType){this.$message.error("请选择文档类型");return}this.loading=!0,this.uploadSuccess=!1,this.uploadError="";try{const e=(await b(this.file,this.fileType)).data;this.docId=e.doc_id,this.fileName=e.filename,this.uploadSuccess=!0,this.$message.success("上传成功")}catch(i){this.uploadError=i.message||"上传失败，请重试",this.$message.error("上传失败")}finally{this.loading=!1}},resetForm(){this.file=null,this.fileType="需求规格说明",this.uploadSuccess=!1,this.uploadError="",this.docId="",this.fileName=""},goToParse(){this.$router.push(`/parse/${this.docId}`)},goToHistory(){this.$router.push("/history")}}},E={class:"upload"},N={class:"card-body"};function I(i,e,V,S,t,r){const n=s("el-button"),y=s("el-upload"),u=s("el-form-item"),c=s("el-option"),g=s("el-select"),x=s("el-form"),f=s("el-alert"),k=s("el-card");return p(),T("div",E,[o(k,{shadow:"hover",style:{"max-width":"600px",margin:"0 auto"}},{header:l(()=>[...e[1]||(e[1]=[a("div",{class:"card-header"},[a("span",null,"文档上传")],-1)])]),default:l(()=>[a("div",N,[o(x,{"label-width":"120px"},{default:l(()=>[o(u,{label:"选择文件"},{default:l(()=>[o(y,{class:"upload-demo",action:"","auto-upload":!1,"on-change":r.handleFileChange,"show-file-list":!0,accept:".txt,.docx",limit:1,"on-exceed":r.handleExceed},{tip:l(()=>[...e[3]||(e[3]=[a("div",{class:"el-upload__tip"}," 请上传txt或docx格式的文件 ",-1)])]),default:l(()=>[o(n,{type:"primary"},{default:l(()=>[...e[2]||(e[2]=[d("选择文件",-1)])]),_:1})]),_:1},8,["on-change","on-exceed"])]),_:1}),o(u,{label:"文档类型"},{default:l(()=>[o(g,{modelValue:t.fileType,"onUpdate:modelValue":e[0]||(e[0]=C=>t.fileType=C),placeholder:"请选择文档类型",style:{width:"100%"}},{default:l(()=>[o(c,{label:"需求规格说明",value:"需求规格说明"}),o(c,{label:"其他",value:"其他"})]),_:1},8,["modelValue"])]),_:1}),o(u,null,{default:l(()=>[o(n,{type:"primary",onClick:r.handleUpload,loading:t.loading},{default:l(()=>[...e[4]||(e[4]=[d("上传文档",-1)])]),_:1},8,["onClick","loading"]),o(n,{onClick:r.resetForm},{default:l(()=>[...e[5]||(e[5]=[d("重置",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1}),t.uploadSuccess?(p(),m(f,{key:0,title:"上传成功！文档ID: "+t.docId,type:"success","show-icon":"",closable:!1,style:{"margin-top":"20px"}},{default:l(()=>[a("div",null,[a("p",null,"文件名: "+h(t.fileName),1),a("p",null,"文档类型: "+h(t.fileType),1),o(n,{type:"primary",size:"small",onClick:r.goToParse},{default:l(()=>[...e[6]||(e[6]=[d("解析文档",-1)])]),_:1},8,["onClick"]),o(n,{type:"success",size:"small",onClick:r.goToHistory},{default:l(()=>[...e[7]||(e[7]=[d("查看历史",-1)])]),_:1},8,["onClick"])])]),_:1},8,["title"])):_("",!0),t.uploadError?(p(),m(f,{key:1,title:"上传失败: "+t.uploadError,type:"error","show-icon":"",closable:!1,style:{"margin-top":"20px"}},null,8,["title"])):_("",!0)])]),_:1})])}const F=w(v,[["render",I],["__scopeId","data-v-b6f9577d"]]);export{F as default};
