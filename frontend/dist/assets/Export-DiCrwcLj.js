import{e as C}from"./api-B5B5DeYR.js";import{_ as I,c as h,a as t,w as o,b as i,e as E,f as x,d as c,r as s,o as u}from"./index-ahAVBiDV.js";const v={name:"Export",data(){return{docId:"",loading:!1,exportError:"",exportSuccess:!1,exportFile:"",requirements:[]}},mounted(){this.docId=this.$route.params.docId,this.handleExport()},methods:{async handleExport(){if(!this.docId){this.$message.error("文档ID不能为空");return}this.loading=!0,this.exportError="",this.exportSuccess=!1,this.exportFile="",this.requirements=[];try{const l=await C(this.docId);this.exportFile=l.data.export_file,this.requirements=l.data.requirements,this.exportSuccess=!0,this.$message.success("导出成功")}catch(l){this.exportError=l.message||"导出失败，请重试",this.$message.error("导出失败")}finally{this.loading=!1}},downloadJson(){const l=JSON.stringify(this.requirements,null,2),e=new Blob([l],{type:"application/json"}),m=URL.createObjectURL(e),n=document.createElement("a");n.href=m,n.download=this.exportFile||`requirements_${this.docId}.json`,document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(m)},goToHistory(){this.$router.push("/history")},goToParse(){this.$router.push(`/parse/${this.docId}`)}}},q={class:"export"},V={class:"card-header"},N={class:"card-body"},S={key:1,style:{"margin-top":"20px"}},j={style:{"margin-top":"20px"}};function B(l,e,m,n,r,a){const d=s("el-button"),f=s("el-input"),y=s("el-form-item"),b=s("el-form"),_=s("el-alert"),p=s("el-table-column"),g=s("el-table"),k=s("el-card");return u(),h("div",q,[t(k,{shadow:"hover",style:{"max-width":"800px",margin:"0 auto"}},{header:o(()=>[i("div",V,[e[2]||(e[2]=i("span",null,"需求导出",-1)),t(d,{type:"primary",onClick:a.handleExport,loading:r.loading},{default:o(()=>[...e[1]||(e[1]=[c("导出需求",-1)])]),_:1},8,["onClick","loading"])])]),default:o(()=>[i("div",N,[t(b,{"label-width":"120px"},{default:o(()=>[t(y,{label:"文档ID"},{default:o(()=>[t(f,{modelValue:r.docId,"onUpdate:modelValue":e[0]||(e[0]=w=>r.docId=w),readonly:""},null,8,["modelValue"])]),_:1})]),_:1}),r.exportError?(u(),E(_,{key:0,title:"导出失败: "+r.exportError,type:"error","show-icon":"",closable:!1,style:{"margin-top":"20px"}},null,8,["title"])):x("",!0),r.exportSuccess?(u(),h("div",S,[t(_,{title:"导出成功！文件名: "+r.exportFile,type:"success","show-icon":"",closable:!1},null,8,["title"]),e[6]||(e[6]=i("h3",{style:{"margin-top":"20px"}},"需求列表",-1)),t(g,{data:r.requirements,style:{width:"100%","margin-top":"10px"}},{default:o(()=>[t(p,{prop:"id",label:"需求ID",width:"120"}),t(p,{prop:"title",label:"需求标题"}),t(p,{prop:"description",label:"需求描述"}),t(p,{prop:"parent_id",label:"父需求ID",width:"120"})]),_:1},8,["data"]),i("div",j,[t(d,{type:"primary",onClick:a.downloadJson},{default:o(()=>[...e[3]||(e[3]=[c("下载JSON文件",-1)])]),_:1},8,["onClick"]),t(d,{onClick:a.goToHistory},{default:o(()=>[...e[4]||(e[4]=[c("查看历史",-1)])]),_:1},8,["onClick"]),t(d,{onClick:a.goToParse},{default:o(()=>[...e[5]||(e[5]=[c("查看需求树",-1)])]),_:1},8,["onClick"])])])):x("",!0)])]),_:1})])}const T=I(v,[["render",B],["__scopeId","data-v-c3c35d09"]]);export{T as default};
